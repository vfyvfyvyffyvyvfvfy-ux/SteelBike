# –ê—É–¥–∏—Ç Server.js —Ñ–∞–π–ª–æ–≤

## –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

### 1. prizmatic-server/server.js ‚úÖ

**–°—Ç–∞—Ç—É—Å**: –í—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
- `process.env.PORT` - –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (default: 10000)
- `process.env.SUPABASE_URL` - URL Supabase
- `process.env.SUPABASE_SERVICE_ROLE_KEY` - Service Role –∫–ª—é—á
- `process.env.TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `process.env.BOT_USERNAME` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç–∞ (default: 'pr1zmaticbot')
- `process.env.WEBAPP_NAME` - –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è Web App (default: 'app')

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF –¥–æ–≥–æ–≤–æ—Ä—ã –∏ –∞–∫—Ç—ã –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–æ–≤
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∞—Ä–µ–Ω–¥–∞–º–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º—ã**: –ù–µ—Ç

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- –û–±–Ω–æ–≤–∏—Ç—å `BOT_USERNAME` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ env vars —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ Render/Vercel

---

### 2. ocr-worker/server.js ‚úÖ

**–°—Ç–∞—Ç—É—Å**: –í—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
- `process.env.PORT` - –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (default: 3000)
- `process.env.SUPABASE_URL` - URL Supabase
- `process.env.SUPABASE_SERVICE_ROLE_KEY` - Service Role –∫–ª—é—á
- `process.env.GEMINI_API_KEY` - –∫–ª—é—á Google Gemini API
- `process.env.INTERNAL_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∑–∞—â–∏—Ç—ã endpoint

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç OCR (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞) —Å –ø–æ–º–æ—â—å—é Gemini API
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ URL
- –ó–∞—â–∏—â–µ–Ω —á–µ—Ä–µ–∑ `x-internal-secret` header

**–ü—Ä–æ–±–ª–µ–º—ã**: –ù–µ—Ç

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `INTERNAL_SECRET` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã Gemini API

---

## –û–±—â–∏–µ –≤—ã–≤–æ–¥—ã:

### ‚úÖ –ß—Ç–æ —Ö–æ—Ä–æ—à–æ:
1. –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –ù–µ—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏–ª–∏ –∫–ª—é—á–µ–π
3. –ï—Å—Ç—å fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
4. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render.com** (–¥–ª—è prizmatic-server):
   ```
   SUPABASE_URL=https://avamqfmuhiwtlumjkzmv.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
   TELEGRAM_BOT_TOKEN=8126548981:AAGC86ZaJ0SYLICC0WbpS7aGOhU9t8iz_a4
   BOT_USERNAME=PRIZMATICbot (–∏–ª–∏ –≤–∞—à–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏–º—è)
   WEBAPP_NAME=app
   PORT=10000
   ```

2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è ocr-worker**:
   ```
   SUPABASE_URL=https://avamqfmuhiwtlumjkzmv.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
   GEMINI_API_KEY=AIzaSyCds0FmujbSW88GPJwXeyhIjD8JOdyx5uU
   INTERNAL_SECRET=MySuperSecretKeyForBikeAppOCR123!
   PORT=3000
   ```

3. **BOT_USERNAME** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏–º—è –±–æ—Ç–∞:
   - –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `pr1zmaticbot`
   - –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–º—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞

### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–°–æ–∑–¥–∞—Ç—å .env.example –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞**:
   - `prizmatic-server/.env.example`
   - `ocr-worker/.env.example`

2. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ env vars** –≤ README –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π**:
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ env vars —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ Render.com
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ "not configured"

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ –≤ Render.com
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render.com
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å BOT_USERNAME –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å .env.example —Ñ–∞–π–ª—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–æ–≥–æ–≤–æ—Ä–æ–≤
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å OCR –æ–±—Ä–∞–±–æ—Ç–∫—É
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:
- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ INTERNAL_SECRET –¥–ª—è –∑–∞—â–∏—Ç—ã endpoints
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### ‚ö†Ô∏è –£–ª—É—á—à–µ–Ω–∏—è:
- –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è API endpoints
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JWT –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
